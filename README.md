# Dynamic Functional Connectivity – K-Means Clustering Pipeline

This repository contains a full analysis pipeline for extracting and characterising 
dynamic functional connectivity (DFC) states from fMRI data. The workflow is designed 
to process connectivity matrices generated by the [DynamicBC Toolbox](https://www.nitrc.org/projects/dynamicbc/), 
prepare them for machine learning, identify optimal clustering solutions, and perform 
statistical comparisons across groups (e.g., healthy controls vs. clinical populations).

Important: this code is using the Dosenbach Atlas with 160 regions, if you are using Atlas with different number of regions or .mat matrices with different number of columns and rows you should simply modify it.

## Pipeline Overview
1. **Preprocessing – `np_maker.py`**
   - Converts `.mat` connectivity matrices (DynamicBC output) to `.npy` arrays.
   - Applies ROI subsetting and Fisher z-normalization.
   - Saves subject- and group-level window vectors for downstream clustering.

2. **Cluster Number Estimation – `elbow_analysis.py`**
   - Loads `.npy` data and subsamples windows.
   - Runs MiniBatch K-Means across candidate K values.
   - Generates elbow plots (inertia vs K) and silhouette scores.
   - Helps identify an appropriate K for final analysis.

3. **Final Analysis – `final_analysis.py`**
   - Initializes K-Means with exemplar-based centroids for stability.
   - Computes subject-level metrics: state occupancy, dwell time, transitions, entropy.
   - Performs group comparisons with t-tests, FDR correction, and effect size estimation.
   - Exports Excel summaries and visualizations (heatmaps, edge differences, transition matrices).

---

## Repository Structure
